<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>W06D4-LOs-explained</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h2 id="testing-in-javascript-w6d4---learning-objectives">Testing in JavaScript (W6D4) - Learning Objectives</h2>
<h3 id="testing">Testing</h3>
<ol type="1">
<li>Explain the “red-green-refactor” loop of test-driven development.</li>
</ol>
<ul>
<li>Red: Write tests and watch them fail (protect against false positives)</li>
<li>Green: Write the minimum amount of code to get the test to pass</li>
<li>Refactor: Refactor the written code so that it is easy to maintain and understand</li>
</ul>
<ol start="2" type="1">
<li>Identify the definitions of SyntaxError, ReferenceError, and TypeError</li>
</ol>
<ul>
<li>SyntaxError
<ul>
<li>an error in how the code is written</li>
<li>encountered at compile-time, ie the code cannot be parsed to determine the instructions</li>
<li>since our code cannot be run, SyntaxErrors cannot be caught by a try-catch block</li>
<li>common examples would be:
<ul>
<li>a misspelled function keyword (<code>funtion broken() {...}</code>)</li>
<li>incorrect number of curly braces</li>
</ul></li>
</ul></li>
<li>ReferenceError
<ul>
<li>when a nonexistent variable is referenced</li>
<li>most commonly seen when you mistype a variable name, or refer to one out of the current scope</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">const</span> puppy <span class="op">=</span> <span class="st">&quot;puppy&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="va">console</span>.<span class="at">log</span>(pupy)<span class="op">;</span> <span class="co">// mistyped variable name</span></a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">function</span> <span class="at">callPuppy</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">    <span class="kw">const</span> puppy <span class="op">=</span> <span class="st">&quot;puppy&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="op">}</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="va">console</span>.<span class="at">log</span>(puppy)<span class="op">;</span> <span class="co">// puppy is not in scope, it was created in the callPuppy function</span></a></code></pre></div></li>
</ul>
<ol start="3" type="1">
<li>Create, modify, and get to pass a suite of Mocha tests</li>
</ol>
<ul>
<li>File Structure
<ul>
<li>Mocha will expect a <code>test</code> directory at the location that we are running our <code>mocha</code> command (typically the top level of our project)</li>
</ul>
<pre><code>testing-demo
└──
problems
    └── reverse-string.js
test
    └── reverse-string-spec.js</code></pre></li>
<li>Setting up <code>describe</code> and <code>it</code> blocks
<ul>
<li>We want to keep our tests organized just like our code.</li>
<li>A <code>describe</code> block gives a high level indication of what we are going to be testing, like the name of the function, module, or unit of code.</li>
<li>An <code>it</code> block tells us something that we are specifically testing. It defines an individual test that we are running.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="at">describe</span> (<span class="st">&#39;reverseString()&#39;</span><span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">    <span class="at">it</span>(<span class="st">&#39;should reverse the input string&#39;</span><span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb4-3" title="3">        <span class="co">// a test will go here!</span></a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="op">}</span>)</a>
<a class="sourceLine" id="cb4-5" title="5"><span class="op">}</span></a></code></pre></div></li>
<li>Using <code>assert</code> to test
<ul>
<li>Inside our <code>it</code> blocks we can use the <code>assert</code> module to execute a test.</li>
<li>There are many different functions we can use in this module.</li>
<li>A very common one is to use the <code>strictEqual</code> function, which compares two values. We can see other less common functions in the docs: https://nodejs.org/docs/latest-v12.x/api/assert.html#</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="co">// remember we required the assert module and reverseString function at the top of this file</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="at">describe</span>(<span class="st">&quot;reverseString()&quot;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb5-3" title="3">    <span class="at">it</span>(<span class="st">&quot;should reverse the input string&quot;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb5-4" title="4">        <span class="kw">let</span> test <span class="op">=</span> <span class="at">reverseString</span>(<span class="st">&quot;hello&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-5" title="5">        <span class="kw">let</span> result <span class="op">=</span> <span class="st">&quot;olleh&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-6" title="6">        <span class="co">// the line below is where the actual test is!</span></a>
<a class="sourceLine" id="cb5-7" title="7">        <span class="va">assert</span>.<span class="at">strictEqual</span>(test<span class="op">,</span> result)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-8" title="8">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<ul>
<li>Another common thing to test is that a function throws an error appropriately. We can use the <code>throws</code> function, which accepts a callback to invoke, the error we expect when that callback is invoked, and a message to show if the fail doesn’t go through correctly.
<ul>
<li>It’s important to note here that if we expect our function to throw an error, we cannot invoke it immediately, or else our test file itself will error out. We need to surround it in another function creating a callback to be invoked later. Our assertion is then able to compare the error to the second argument.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="co">// note that we are passing function(){reverseString(3);} as an argument, not reverseString(3) directly</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="at">context</span>(<span class="st">&quot;given an argument that is not a string&quot;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="at">it</span>(<span class="st">&quot;should throw a TypeError when given an argument that is not a string&quot;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb6-4" title="4">    <span class="va">assert</span>.<span class="at">throws</span>(</a>
<a class="sourceLine" id="cb6-5" title="5">    <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb6-6" title="6">        <span class="at">reverseString</span>(<span class="dv">3</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-7" title="7">    <span class="op">},</span></a>
<a class="sourceLine" id="cb6-8" title="8">    TypeError<span class="op">,</span></a>
<a class="sourceLine" id="cb6-9" title="9">    <span class="st">&quot;this function only accepts string args&quot;</span></a>
<a class="sourceLine" id="cb6-10" title="10">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div></li>
</ul></li>
</ul>
<ol start="4" type="1">
<li>Use Chai to structure your tests using behavior-driven development principles.</li>
</ol>
<ul>
<li>BDD vs. TDD =&gt; behavior driven development centers around what an application should do in plain english while TDD centers around how an application is implemented</li>
<li>The Chai testing library provides additional functionality compared to using the basic <code>assert</code> module that comes with Node.</li>
<li>Since it is external, we need to add it to our project with <code>npm install chai</code></li>
<li>After adding the library, we can require it just like the <code>assert</code> module with <code>const chai = require("chai");</code> at the top of our test files.</li>
<li>Using <code>expect</code> from the <code>chai</code> library, we can chain “getters” together to construct tests that read like English. Since we use <code>expect</code> so much in our code, we generally separate it out at the top once instead of for each test: <code>const expect = chai.expect;</code></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">const</span> chai <span class="op">=</span> <span class="at">require</span>(<span class="st">&quot;chai&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">const</span> expect <span class="op">=</span> <span class="va">chai</span>.<span class="at">expect</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">// don&#39;t forget to import the class you are testing!</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="kw">const</span> Dog <span class="op">=</span> <span class="at">require</span>(<span class="st">&quot;../problems/dog.js&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-6" title="6"></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="at">describe</span>(<span class="st">&quot;Dog Constructor Function&quot;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb7-8" title="8">  <span class="at">it</span>(<span class="st">&#39;should have a &quot;name&quot; property&#39;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb7-9" title="9">    <span class="kw">const</span> layla <span class="op">=</span> <span class="kw">new</span> <span class="at">Dog</span>(<span class="st">&quot;Layla&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-10" title="10">    <span class="at">expect</span>(layla).<span class="va">to</span>.<span class="va">have</span>.<span class="at">property</span>(<span class="st">&quot;name&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-11" title="11">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-12" title="12"></a>
<a class="sourceLine" id="cb7-13" title="13">  <span class="at">it</span>(<span class="st">&#39;should set the &quot;name&quot; property when a new dog is created&#39;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb7-14" title="14">    <span class="kw">const</span> layla <span class="op">=</span> <span class="kw">new</span> <span class="at">Dog</span>(<span class="st">&quot;Layla&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-15" title="15">    <span class="co">// we are using the eql function to compare the value of layla.name</span></a>
<a class="sourceLine" id="cb7-16" title="16">    <span class="co">// with the provided string</span></a>
<a class="sourceLine" id="cb7-17" title="17">    <span class="at">expect</span>(<span class="va">layla</span>.<span class="at">name</span>).<span class="va">to</span>.<span class="at">eql</span>(<span class="st">&quot;Layla&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-18" title="18">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-19" title="19"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<ul>
<li>This is a great cheatsheet for understanding what common chains are available to us: https://devhints.io/chai</li>
<li>We can also reference the docs for a more detailed explanation: https://www.chaijs.com/api/bdd/</li>
</ul>
<ol start="5" type="1">
<li>Use the pre- and post-test hooks provided by Mocha</li>
</ol>
<ul>
<li>We learned about four hooks
<ul>
<li>before(‘description’, callback): Callback is invoked before the block of test code is run</li>
<li>beforeEach(‘description’, callback): Callback is invoked before each <code>it</code> statement in the block of test code</li>
<li>after(‘description’, callback): Callback is invoked after the block of test code is run</li>
<li>afterEach(‘description’, callback): Callback is invoked after each <code>it</code> statement in the block of test code</li>
</ul></li>
<li>before and beforeEach allows us to set up our test, pulling out common Arrange or Act portions of our tests</li>
<li>after and afterEach are going to be less common for us, but allow us to do any kind of cleanup that may be necessary after a test has run
<ul>
<li>Looking forward, maybe we need to remove something from our database that our test created</li>
</ul></li>
</ul>
<ol start="6" type="1">
<li>Be familiar with <code>chai-spies</code> and its ability to test how many times a function is invoked</li>
</ol>
<ul>
<li>After adding the <code>chai-spies</code> package to our project with <code>npm install chai-spies</code>, we can require it in our testing file. We are extending the functionality of the <code>chai</code> library, which has the <code>use</code> function to allow us to do so:</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">const</span> spies <span class="op">=</span> <span class="at">require</span>(<span class="st">&quot;chai-spies&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="va">chai</span>.<span class="at">use</span>(spies)<span class="op">;</span></a></code></pre></div>
<ul>
<li>After this initial setup, we can spy on a particular function by creating a spy:</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="co">// `on` takes in the object that we are spying on and the method we want to specifically watch</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co">// Here we are saying to look at the layla object and track the calls to the chaseTail method</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw">const</span> chaseTailSpy <span class="op">=</span> <span class="va">chai</span>.<span class="va">spy</span>.<span class="at">on</span>(layla<span class="op">,</span> <span class="st">&quot;chaseTail&quot;</span>)<span class="op">;</span></a></code></pre></div>
<ul>
<li>With our spy created, we can invoke whatever functions we would expect to call (or not call, if we are expecting 0 invocations) our method. We can then expect that our spy has been called any number of times:</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="at">context</span>(<span class="st">&quot;with a valid number parameter&quot;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb10-2" title="2">  <span class="at">it</span>(<span class="st">&quot;should call the chaseTail method n times&quot;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb10-3" title="3">    <span class="kw">const</span> chaseTailSpy <span class="op">=</span> <span class="va">chai</span>.<span class="va">spy</span>.<span class="at">on</span>(layla<span class="op">,</span> <span class="st">&quot;chaseTail&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-4" title="4">    <span class="va">layla</span>.<span class="at">chainChaseTail</span>(<span class="dv">3</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-5" title="5">    <span class="co">// below is our actual test to see how many times our spy was invoked</span></a>
<a class="sourceLine" id="cb10-6" title="6">    <span class="at">expect</span>(chaseTailSpy).<span class="va">to</span>.<span class="va">have</span>.<span class="va">been</span>.<span class="va">called</span>.<span class="at">exactly</span>(<span class="dv">3</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-7" title="7">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="at">describe</span>(<span class="st">&#39;myMap(array, callback)&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb11-2" title="2">    <span class="kw">let</span> inputArray<span class="op">;</span></a>
<a class="sourceLine" id="cb11-3" title="3">    <span class="kw">let</span> callback <span class="op">=</span> (el) <span class="kw">=&gt;</span> el <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-4" title="4">    <span class="at">beforeEach</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb11-5" title="5">        inputArray <span class="op">=</span> [ <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span> ]<span class="op">;</span></a>
<a class="sourceLine" id="cb11-6" title="6">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-7" title="7">    <span class="co">// ...other tests</span></a>
<a class="sourceLine" id="cb11-8" title="8">    <span class="at">it</span>(<span class="st">&#39;should not call Array#map&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb11-9" title="9">        <span class="co">// The object we are spying on is the inputArray</span></a>
<a class="sourceLine" id="cb11-10" title="10">        <span class="co">// We want to make sure we don&#39;t call `map` on it</span></a>
<a class="sourceLine" id="cb11-11" title="11">            <span class="co">// We want our function do its own iteration and invocation</span></a>
<a class="sourceLine" id="cb11-12" title="12">            <span class="co">// We are emulating Array#map instead of calling it directly</span></a>
<a class="sourceLine" id="cb11-13" title="13">        <span class="kw">const</span> mapSpy <span class="op">=</span> <span class="va">chai</span>.<span class="va">spy</span>.<span class="at">on</span>(inputArray<span class="op">,</span> <span class="st">&#39;map&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-14" title="14">        <span class="at">myMap</span>(inputArray<span class="op">,</span> callback)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-15" title="15"></a>
<a class="sourceLine" id="cb11-16" title="16">        <span class="at">expect</span>(mapSpy).<span class="va">to</span>.<span class="va">not</span>.<span class="va">have</span>.<span class="va">been</span>.<span class="at">called</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb11-17" title="17">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-18" title="18"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
</body>
</html>
