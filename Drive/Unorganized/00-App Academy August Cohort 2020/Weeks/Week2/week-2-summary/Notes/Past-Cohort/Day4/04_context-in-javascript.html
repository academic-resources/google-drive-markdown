<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>04_context-in-javascript</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="context-in-javascript">Context in JavaScript</h1>
<hr />
<!-- @import "[TOC]" {cmd="toc" depthFrom=2 depthTo=6 orderedList=false} -->
<!-- code_chunk_output -->
<ul>
<li><a href="#what-about-this">What about <code>this</code>?</a></li>
<li><a href="#issues-with-scope-and-context">Issues with scope and context</a>
<ul>
<li><a href="#when-methods-have-an-unexpected-context">When methods have an unexpected context</a></li>
<li><a href="#strictly-protecting-the-global-object">Strictly protecting the global object</a></li>
</ul></li>
<li><a href="#changing-context-using-bind">Changing context using <code>bind</code></a>
<ul>
<li><a href="#binding-with-arguments">Binding with arguments</a></li>
</ul></li>
<li><a href="#what-you-learned">What you learned</a></li>
</ul>
<!-- /code_chunk_output -->
<hr />
<p>It’s now time to dive into one of the most interesting concepts in JavaScript: the idea of <strong>context</strong>.</p>
<p>Programmers from the junior to senior level often confuse <em>scope</em> and <em>context</em> as the same thing - but that is not the case! Every function that is invoked has <strong>both</strong> a scope and a context associated with that function. <em>Scope</em> refers to the visibility and availability of variables, whereas <em>context</em> refers to the value of the <code>this</code> keyword when code is executed.</p>
<p>When you finish this reading you should be able to:</p>
<ul>
<li>Define a method that references <code>this</code> on an object</li>
<li>Identify what <code>this</code> refers to in a code snippet</li>
<li>Utilize the built in <code>Function#bind</code> to maintain the context of <code>this</code></li>
</ul>
<h2 id="what-about-this">What about <code>this</code>?</h2>
<p>When learning about objects we previously came across the idea of a <em>method</em>. A <em>method</em> is a function that is a value within an object and belongs to an object.</p>
<p>There will be times when you will have to know which object a method belongs to. The keyword <code>this</code> exists in every function and it evaluates to the object that is currently invoking that function. So the value of <code>this</code> relies entirely on <strong>where</strong> a function is invoked.</p>
<p>That may sound pretty abstract, so let’s jump into an example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">let</span> dog <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Bowser&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4">  <span class="dt">isSitting</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6">  <span class="dt">stand</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="kw">this</span>.<span class="at">isSitting</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="cf">return</span> <span class="kw">this</span>.<span class="at">isSitting</span><span class="op">;</span></a>
<a class="sourceLine" id="cb1-9" title="9">  <span class="op">},</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="op">};</span></a>
<a class="sourceLine" id="cb1-11" title="11"></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="co">// Bowser starts out sitting</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="va">console</span>.<span class="at">log</span>(<span class="va">dog</span>.<span class="at">isSitting</span>)<span class="op">;</span> <span class="co">// prints `true`</span></a>
<a class="sourceLine" id="cb1-14" title="14"></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="co">// Let&#39;s make him stand</span></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="va">console</span>.<span class="at">log</span>(<span class="va">dog</span>.<span class="at">stand</span>())<span class="op">;</span> <span class="co">// prints `false`</span></a>
<a class="sourceLine" id="cb1-17" title="17"></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="co">// He&#39;s actually standing now!</span></a>
<a class="sourceLine" id="cb1-19" title="19"><span class="va">console</span>.<span class="at">log</span>(<span class="va">dog</span>.<span class="at">isSitting</span>)<span class="op">;</span> <span class="co">// prints `false`</span></a></code></pre></div>
<p>Inside of a method, we can use the keyword <code>this</code> to refer to the object that is calling that method! So when calling <code>dog.stand()</code> and we invoke the code of the <code>stand</code> method, <code>this</code> will refer to the <code>dog</code> object.</p>
<p>Still skeptical? Don’t take our word for it, check <code>this</code> (heh) out:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">let</span> dog <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Bowser&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="dt">test</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="cf">return</span> <span class="kw">this</span> <span class="op">===</span> dog<span class="op">;</span></a>
<a class="sourceLine" id="cb2-6" title="6">  <span class="op">},</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="op">};</span></a>
<a class="sourceLine" id="cb2-8" title="8"></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="va">console</span>.<span class="at">log</span>(<span class="va">dog</span>.<span class="at">test</span>())<span class="op">;</span> <span class="co">// prints `true`</span></a></code></pre></div>
<p>In short, by using the <code>this</code> keyword inside a method, we can refer to values within that object.</p>
<p>Let’s look at another example of this:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">let</span> cat <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="dt">purr</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;meow&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="op">},</span></a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="dt">purrMore</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="kw">this</span>.<span class="at">purr</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="op">},</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="op">};</span></a>
<a class="sourceLine" id="cb3-9" title="9"></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="va">cat</span>.<span class="at">purrMore</span>()<span class="op">;</span></a></code></pre></div>
<p>Through the <code>this</code> variable, the <code>purrMore</code> method can access the object it was called on. In <code>purrMore</code>, we use <code>this</code> to access the <code>cat</code> object that has a <code>purr</code> method. In other words, inside of the <code>purrMore</code> function if we had tried to use <code>purr()</code> instead of <code>this.purr()</code> it would not work.</p>
<p>When we invoked the <code>purrMore</code> function using <code>cat.purrMore</code> we used a <strong>method-style</strong> invocation.</p>
<p>Method style invocations follow the format: <code>object.method(args)</code>. You’ve already been doing this using built in data type methods! (i.e. <code>Array#push</code>, <code>String#toUpperCase</code>, etc.)</p>
<p>Using <em>method-style invocation</em> (note the <em>dot notation</em>) ensures the method will be invoked and that the <code>this</code> within the method will be the object that method was called upon.</p>
<p>Now that we have gone over what <code>this</code> refers to - you can have a full understanding of the definition of context. <strong>Context refers to the value of <code>this</code> within a function and <code>this</code> refers to where a function is invoked</strong>.</p>
<h2 id="issues-with-scope-and-context">Issues with scope and context</h2>
<p>In the case of context the value of <code>this</code> is determined by <em>how</em> a function is invoked. In the above section we talked briefly about <em>method-style invocation</em>, where <code>this</code> is set to the object the method was called upon.</p>
<p>Let’s now talk about what <code>this</code> is when using normal <em>function style invocation</em>.</p>
<p>If you run the following in Node:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">function</span> <span class="at">testMe</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="kw">this</span>)<span class="op">;</span> <span class="co">//</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="op">}</span></a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="at">testMe</span>()<span class="op">;</span> <span class="co">// Object [global] {global: [Circular], etc.}</span></a></code></pre></div>
<p>When you run the above <code>testMe</code> function in Node you’ll see that <code>this</code> is set to the <code>global</code> object. To reiterate: each function you invoke will have <em>both</em> a context and a scope. So even running functions in Node that are not defined explicitly on declared objects are run using the global object as their <code>this</code> and therefore their context.</p>
<h3 id="when-methods-have-an-unexpected-context">When methods have an unexpected context</h3>
<p>So let’s now look at what happens when we try to invoke a method using an unintended context.</p>
<p>Say we have a function that will change the name of a dog object:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">let</span> dog <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Bowser&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="dt">changeName</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="kw">this</span>.<span class="at">name</span> <span class="op">=</span> <span class="st">&quot;Layla&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="op">},</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="op">};</span></a></code></pre></div>
<p>Now say we wanted to take the <code>changeName</code> function above and call it somewhere else. Maybe we have a callback we’d like to pass it to or another object or something like that.</p>
<p>Let’s take a look at what happens when we try to isolate and invoke just the <code>changeName</code> function:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">let</span> dog <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Bowser&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="dt">changeName</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb6-4" title="4">    <span class="kw">this</span>.<span class="at">name</span> <span class="op">=</span> <span class="st">&quot;Layla&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="op">},</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="op">};</span></a>
<a class="sourceLine" id="cb6-7" title="7"></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">// note this is **not invoked** - we are assigning the function itself</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="kw">let</span> change <span class="op">=</span> <span class="va">dog</span>.<span class="at">changeName</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="va">console</span>.<span class="at">log</span>(<span class="at">change</span>())<span class="op">;</span> <span class="co">// undefined</span></a>
<a class="sourceLine" id="cb6-11" title="11"></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co">// our dog still has the same name</span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="va">console</span>.<span class="at">log</span>(dog)<span class="op">;</span> <span class="co">// { name: &#39;Bowser&#39;, changeName: [Function: changeName] }</span></a>
<a class="sourceLine" id="cb6-14" title="14"></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="co">// instead of changing the dog we changed the global name!!!</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="va">console</span>.<span class="at">log</span>(<span class="kw">this</span>)<span class="op">;</span> <span class="co">// Object [global] {etc, etc, etc,  name: &#39;Layla&#39;}</span></a></code></pre></div>
<p>So in the above code notice how we stored the <code>dog.changeName</code> function <em>without invoking it</em> to the variable <code>change</code>. On the next line when we did invoke the <code>change</code> function we can see that we did not actually change the <code>dog</code> object like we intended to. We created a new key value pair for <code>name</code> on the global object! This is because we invoked change without the context of a specific object (like <code>dog</code>), so JavaScript used the only object available to it, the <strong>global object</strong>!</p>
<p>The above example might seem like an annoying inconvenience but let’s take a look at what happens when calling something in the wrong context can be a big problem.</p>
<p>Using our <code>cat</code> object from before:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">let</span> cat <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="dt">purr</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb7-3" title="3">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;meow&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="op">},</span></a>
<a class="sourceLine" id="cb7-5" title="5">  <span class="dt">purrMore</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="kw">this</span>.<span class="at">purr</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb7-7" title="7">  <span class="op">},</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="op">};</span></a>
<a class="sourceLine" id="cb7-9" title="9"></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="kw">let</span> notACat <span class="op">=</span> <span class="va">cat</span>.<span class="at">purrMore</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="va">console</span>.<span class="at">log</span>(<span class="at">notACat</span>())<span class="op">;</span> <span class="co">// TypeError: this.purr is not a function</span></a></code></pre></div>
<p>So in the above code snippet we attempted to call the <code>purrMore</code> function <em>without the correct Object for context</em>. Meaning we attempted to call the <code>purrMore</code> function on the global object! Since the global object does not have a <code>purr</code> method upon its <code>this</code> it raised an error. This is a common problem when invoking methods: invoking methods without their proper context.</p>
<p>Let’s look at one more example of confusing <code>this</code> when using a callback. Incorrectly passing context is an inherent problem with callbacks. The <code>global.setTimeout()</code> method on the global object is a popular way of setting a function to run on a timer. The <code>global.setTimeout()</code> method accepts a callback and a number of milliseconds to wait before invoking the callback.</p>
<p>Let’s look at a simple example:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">let</span> hello <span class="op">=</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb8-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;hello!&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="op">};</span></a>
<a class="sourceLine" id="cb8-4" title="4"></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="co">// global. is a method of the global object!</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="va">global</span>.<span class="at">setTimeout</span>(hello<span class="op">,</span> <span class="dv">5000</span>)<span class="op">;</span> <span class="co">// waits 5 seconds then prints &quot;hello!&quot;</span></a></code></pre></div>
<p>Expanding on the <code>global.setTimeout</code> method now using our <code>cat</code> from before let’s say we wanted our <code>cat</code> to “meow” in 5 seconds instead of right now:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">let</span> cat <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="dt">purr</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb9-3" title="3">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;meow&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-4" title="4">  <span class="op">},</span></a>
<a class="sourceLine" id="cb9-5" title="5">  <span class="dt">purrMore</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb9-6" title="6">    <span class="kw">this</span>.<span class="at">purr</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb9-7" title="7">  <span class="op">},</span></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="op">};</span></a>
<a class="sourceLine" id="cb9-9" title="9"></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="va">global</span>.<span class="at">setTimeout</span>(<span class="va">cat</span>.<span class="at">purrMore</span><span class="op">,</span> <span class="dv">5000</span>)<span class="op">;</span> <span class="co">// 5 seconds later: TypeError: this.purr is not a function</span></a></code></pre></div>
<p>So what happened there? We called <code>cat.purrMore</code> so it should have the right context right? Noooooope. This is because <code>cat.purrMore</code> is a callback in the above code! Meaning that when the <code>global.setTimeout</code> function attempts to call the <code>purrMore</code> function all it has reference to is the function itself. Since <code>setTimeout</code> is on the global object that means that the global object will be the context for attempting to invoke the <code>cat.purrMore</code> function.</p>
<h3 id="strictly-protecting-the-global-object">Strictly protecting the global object</h3>
<p>The accidental mutation of the global object when invoking functions in unintended contexts is one of the reasons JavaScript released “strict” mode in ECMAScript version 5. We won’t dive too much into JavaScript’s strict mode here, but it’s important to know how strict mode can be used to protect the global object.</p>
<p>Writing and running code in strict mode is easy and much like writing code in “sloppy mode” (jargon for the normal JavaScript environment). We can run JavaScript in strict mode simply by adding the string “use strict” at the top of our file:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="st">&quot;use strict&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="kw">function</span> <span class="at">hello</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb10-4" title="4">  <span class="cf">return</span> <span class="st">&quot;Hello!&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="op">}</span></a>
<a class="sourceLine" id="cb10-6" title="6"></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="va">console</span>.<span class="at">log</span>(hello)<span class="op">;</span> <span class="co">// prints &quot;Hello!&quot;</span></a></code></pre></div>
<p>One of the differences of strict mode becomes apparent when trying to access the global object. As we mentioned previously, the global object is the context of invoked functions in Node that are not defined explicitly on declared objects.</p>
<p>So referencing <code>this</code> within a function using the global object as its context will give us access to the global object:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">function</span> <span class="at">hello</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb11-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="kw">this</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="op">}</span></a>
<a class="sourceLine" id="cb11-4" title="4"></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="at">hello</span>()<span class="op">;</span> <span class="co">// Object [global] {etc, etc, etc }</span></a></code></pre></div>
<p>However, strict mode will no longer allow you access to the global object in functions via the <code>this</code> keyword and will instead return <code>undefined</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="st">&quot;use strict&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb12-2" title="2"></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="kw">function</span> <span class="at">hello</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="va">console</span>.<span class="at">log</span>(<span class="kw">this</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="op">}</span></a>
<a class="sourceLine" id="cb12-6" title="6"></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="at">hello</span>()<span class="op">;</span> <span class="co">// undefined</span></a></code></pre></div>
<p>Using strict mode can help us avoid scenarios where we accidentally would have mutated the global object. Let’s take our example from earlier and try it in strict mode:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="st">&quot;use strict&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-2" title="2"></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="kw">let</span> dog <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb13-4" title="4">  <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Bowser&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-5" title="5">  <span class="dt">changeName</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb13-6" title="6">    <span class="kw">this</span>.<span class="at">name</span> <span class="op">=</span> <span class="st">&quot;Layla&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-7" title="7">  <span class="op">},</span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="op">};</span></a>
<a class="sourceLine" id="cb13-9" title="9"></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="co">// // note this is **not invoked** - we are assigning the function itself</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="kw">let</span> changeNameFunc <span class="op">=</span> <span class="va">dog</span>.<span class="at">changeName</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-12" title="12"></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="va">console</span>.<span class="at">log</span>(<span class="at">changeNameFunc</span>())<span class="op">;</span> <span class="co">// TypeError: Cannot set property &#39;name&#39; of undefined</span></a></code></pre></div>
<p>As you can see above, when we attempt to invoke the <code>changeNameFunc</code> an error is thrown because referencing <code>this</code> in strict mode will give us <code>undefined</code> instead of the global object. The above behavior is helpful for catching otherwise tricky bugs.</p>
<p>If you’d like to learn more about strict mode we recommend checking out the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode">documentation</a>.</p>
<h2 id="changing-context-using-bind">Changing context using <code>bind</code></h2>
<p>Good thing JavaScript has something that can solve this problem for us: what is known as the <strong>binding</strong> of a context to a function.</p>
<p>From the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_objects/Function/bind"><code>Function.prototype.bind()</code></a>, “The simplest use of <code>bind()</code> is to make a function that, no matter how it is called, is called with a particular <code>this</code> value”.</p>
<p>Here is a preview of the syntax we use to <code>bind</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">let</span> aboundFunc <span class="op">=</span> <span class="va">func</span>.<span class="at">bind</span>(context)<span class="op">;</span></a></code></pre></div>
<p>So when we call <code>bind</code> we are returned what is called an exotic function. Which essentially means a function with it’s <code>this</code> bound no matter where that function is invoked.</p>
<p>Let’s take a look at example at <code>bind</code> in action:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">let</span> cat <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb15-2" title="2">  <span class="dt">purr</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb15-3" title="3">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;meow&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-4" title="4">  <span class="op">},</span></a>
<a class="sourceLine" id="cb15-5" title="5">  <span class="dt">purrMore</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb15-6" title="6">    <span class="kw">this</span>.<span class="at">purr</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb15-7" title="7">  <span class="op">},</span></a>
<a class="sourceLine" id="cb15-8" title="8"><span class="op">};</span></a>
<a class="sourceLine" id="cb15-9" title="9"></a>
<a class="sourceLine" id="cb15-10" title="10"><span class="kw">let</span> sayMeow <span class="op">=</span> <span class="va">cat</span>.<span class="at">purrMore</span><span class="op">;</span></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="va">console</span>.<span class="at">log</span>(<span class="at">sayMeow</span>())<span class="op">;</span> <span class="co">// TypeError: this.purr is not a function</span></a>
<a class="sourceLine" id="cb15-12" title="12"></a>
<a class="sourceLine" id="cb15-13" title="13"><span class="co">// we can now use the built in Function.bind to ensure our context, our `this`,</span></a>
<a class="sourceLine" id="cb15-14" title="14"><span class="co">// is the cat object</span></a>
<a class="sourceLine" id="cb15-15" title="15"><span class="kw">let</span> boundCat <span class="op">=</span> <span class="va">sayMeow</span>.<span class="at">bind</span>(cat)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-16" title="16"></a>
<a class="sourceLine" id="cb15-17" title="17"><span class="co">// we still *need* to invoke the function</span></a>
<a class="sourceLine" id="cb15-18" title="18"><span class="at">boundCat</span>()<span class="op">;</span> <span class="co">// prints &quot;meow&quot;</span></a></code></pre></div>
<p>That is the magic of <code>Function#bind</code>! It allows you choose the context for your function. You don’t need to restrict the context you’d like to bind to either - you can <code>bind</code> functions to any context.</p>
<p>Let’s look at another example:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">let</span> cat <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb16-2" title="2">  <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Meowser&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb16-3" title="3">  <span class="dt">sayName</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb16-4" title="4">    <span class="va">console</span>.<span class="at">log</span>(<span class="kw">this</span>.<span class="at">name</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-5" title="5">  <span class="op">},</span></a>
<a class="sourceLine" id="cb16-6" title="6"><span class="op">};</span></a>
<a class="sourceLine" id="cb16-7" title="7"></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="kw">let</span> dog <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb16-9" title="9">  <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Fido&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb16-10" title="10"><span class="op">};</span></a>
<a class="sourceLine" id="cb16-11" title="11"></a>
<a class="sourceLine" id="cb16-12" title="12"><span class="kw">let</span> sayNameFunc <span class="op">=</span> <span class="va">cat</span>.<span class="at">sayName</span><span class="op">;</span></a>
<a class="sourceLine" id="cb16-13" title="13"></a>
<a class="sourceLine" id="cb16-14" title="14"><span class="kw">let</span> sayHelloCat <span class="op">=</span> <span class="va">sayNameFunc</span>.<span class="at">bind</span>(cat)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-15" title="15"><span class="at">sayHelloCat</span>()<span class="op">;</span> <span class="co">// prints Meowser</span></a>
<a class="sourceLine" id="cb16-16" title="16"></a>
<a class="sourceLine" id="cb16-17" title="17"><span class="kw">let</span> sayHelloDog <span class="op">=</span> <span class="va">sayNameFunc</span>.<span class="at">bind</span>(dog)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-18" title="18"><span class="at">sayHelloDog</span>()<span class="op">;</span> <span class="co">// prints Fido</span></a></code></pre></div>
<p>Let’s now revisit our above example of losing context in a callback and fix our context! Using the <code>global.setTimeout</code> function we want to call the <code>cat.purrMore</code> function with the context bound to the cat object.</p>
<p>Here we go:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">let</span> cat <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-2" title="2">  <span class="dt">purr</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb17-3" title="3">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;meow&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-4" title="4">  <span class="op">},</span></a>
<a class="sourceLine" id="cb17-5" title="5">  <span class="dt">purrMore</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb17-6" title="6">    <span class="kw">this</span>.<span class="at">purr</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb17-7" title="7">  <span class="op">},</span></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="op">};</span></a>
<a class="sourceLine" id="cb17-9" title="9"></a>
<a class="sourceLine" id="cb17-10" title="10"><span class="co">// here we will bind the cat.purrMore function to the context of the cat object</span></a>
<a class="sourceLine" id="cb17-11" title="11"><span class="kw">const</span> boundPurr <span class="op">=</span> <span class="va">cat</span>.<span class="va">purrMore</span>.<span class="at">bind</span>(cat)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-12" title="12"></a>
<a class="sourceLine" id="cb17-13" title="13"><span class="va">global</span>.<span class="at">setTimeout</span>(boundPurr<span class="op">,</span> <span class="dv">5000</span>)<span class="op">;</span> <span class="co">// prints 5 seconds later: meow</span></a></code></pre></div>
<h3 id="binding-with-arguments">Binding with arguments</h3>
<p>So far we’ve talking of one of the the common uses of the <code>bind</code> function - binding a context to a function. However, bind will not only allow you to bind the context of a function but also to bind <strong>arguments</strong> to a function.</p>
<p>Here is the syntax for binding arguments to a function:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">let</span> aboundFunc <span class="op">=</span> <span class="va">func</span>.<span class="at">bind</span>(context<span class="op">,</span> arg1<span class="op">,</span> arg2<span class="op">,</span> <span class="va">etc</span>...)<span class="op">;</span></a></code></pre></div>
<p>Following that train of logic let’s look at example of binding arguments to a function, regardless of the context:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">const</span> sum <span class="op">=</span> <span class="kw">function</span> (a<span class="op">,</span> b) <span class="op">{</span></a>
<a class="sourceLine" id="cb19-2" title="2">  <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></a>
<a class="sourceLine" id="cb19-3" title="3"><span class="op">};</span></a>
<a class="sourceLine" id="cb19-4" title="4"></a>
<a class="sourceLine" id="cb19-5" title="5"><span class="co">// here we are creating a new function named add3</span></a>
<a class="sourceLine" id="cb19-6" title="6"><span class="co">// this function will bind the value 3 for the first argument</span></a>
<a class="sourceLine" id="cb19-7" title="7"><span class="kw">const</span> add3 <span class="op">=</span> <span class="va">sum</span>.<span class="at">bind</span>(<span class="kw">null</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb19-8" title="8"></a>
<a class="sourceLine" id="cb19-9" title="9"><span class="co">// now when we invoke our new add3 function it will add 3 to</span></a>
<a class="sourceLine" id="cb19-10" title="10"><span class="co">// one incoming argument</span></a>
<a class="sourceLine" id="cb19-11" title="11"><span class="va">console</span>.<span class="at">log</span>(<span class="at">add3</span>(<span class="dv">10</span>))<span class="op">;</span></a></code></pre></div>
<p>Note that in the above snippet where we <code>bind</code> with <code>null</code> we don’t actually use <code>this</code> in the <code>sum</code> function. However, since <code>bind</code> requires a first argument we can put in <code>null</code> as a place holder.</p>
<p>Above when we created the <code>add3</code> function we were creating a new bound function where the context was <code>null</code>, since the context won’t matter, and the first argument will <em>always</em> be <code>3</code> for that function. Whenever we invoke the <code>add3</code> function all other arguments will be passed in normally.</p>
<p>Using <code>bind</code> like this gives you a lot of flexibility with your code. Allowing you to create independent functions that essentially do the same thing while keeping your code very DRY.</p>
<p>Here is another example:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb20-1" title="1"><span class="kw">const</span> multiply <span class="op">=</span> <span class="kw">function</span> (a<span class="op">,</span> b) <span class="op">{</span></a>
<a class="sourceLine" id="cb20-2" title="2">  <span class="cf">return</span> a <span class="op">*</span> b<span class="op">;</span></a>
<a class="sourceLine" id="cb20-3" title="3"><span class="op">};</span></a>
<a class="sourceLine" id="cb20-4" title="4"></a>
<a class="sourceLine" id="cb20-5" title="5"><span class="kw">const</span> double <span class="op">=</span> <span class="va">multiply</span>.<span class="at">bind</span>(<span class="kw">null</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-6" title="6"><span class="kw">const</span> triple <span class="op">=</span> <span class="va">multiply</span>.<span class="at">bind</span>(<span class="kw">null</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-7" title="7"></a>
<a class="sourceLine" id="cb20-8" title="8"><span class="va">console</span>.<span class="at">log</span>(<span class="at">double</span>(<span class="dv">3</span>))<span class="op">;</span> <span class="co">// 6</span></a>
<a class="sourceLine" id="cb20-9" title="9"><span class="va">console</span>.<span class="at">log</span>(<span class="at">triple</span>(<span class="dv">3</span>))<span class="op">;</span> <span class="co">// 9</span></a></code></pre></div>
<h2 id="what-you-learned">What you learned</h2>
<ul>
<li>How to define a method that references <code>this</code> on an object</li>
<li>Identify what <code>this</code> refers to in a code snippet</li>
<li>How to utilize the built in <code>Function#bind</code> to maintain the context of <code>this</code></li>
</ul>
</body>
</html>
